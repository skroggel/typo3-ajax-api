!function(n,i,a){var e="ajaxApi",r={boxSuccessClass:"success",boxHintClass:"hint",boxErrorClass:"error",loadingIndicatorActiveClass:"is-ajax-loading",loadingIndicatorTargetClass:"is-ajax-target",loadingIndicatorHtml:'<div class="loading-indicator"></div>',loadingIndicatorHtmlClass:"ajax-overlay",lastVisualViewportWidth:0};function s(t,s){this.element=t,this.settings=n.extend({},r,s),this._defaults=r,this._name=e,this.init()}n.extend(s.prototype,{init:function(){this.settings.$el=n(this.element),this.settings.elementType=this.settings.$el.prop("tagName"),this.settings.lastVisualViewportWidth=i.visualViewport.width,"FORM"===this.settings.elementType?(this.settings.formElements=this.settings.$el.find(":input:not(.btn)"),this.settings.url=this.settings.$el.attr("action"),this.settings.$el.hasClass("ajax-feedback")&&(this.settings.feedbackUrl=this.settings.$el.attr("data-feedback-url")),this.settings.$el.data("ajax-indicator-id")?this.settings.indicatorTarget=n("#"+this.settings.$el.data("ajax-indicator-id")):this.settings.indicatorTarget=this.settings.$el):"A"===this.settings.elementType?(this.settings.url=this.settings.$el.attr("href"),this.settings.$el.data("ajax-indicator-id")&&(this.settings.indicatorTarget=n("#"+this.settings.$el.data("ajax-indicator-id")))):"TEMPLATE"===this.settings.elementType&&(this.settings.url=this.settings.$el.data("ajax-url"),this.settings.ignore=!1,!this.settings.$el.data("ajax-ignore")||1!==this.settings.$el.data("ajax-ignore")&&"true"!==this.settings.$el.data("ajax-ignore").toLowerCase()||(this.settings.ignore=!0),this.settings.ignore||(this.settings.$el.data("ajax-max-width")?this.sendOnViewport():this.sendOnPageLoad())),this.bindEvents()},bindEvents:function(){var t,e;"FORM"===this.settings.elementType?(t=this).settings.$el.hasClass("ajax")&&this.settings.$el.hasClass("ajax-feedback")?(this.settings.formElements.each(function(){n(this).on("change",t.sendField.bind(t))}),this.settings.$el.on("submit",this.sendForm.bind(this))):this.settings.$el.hasClass("ajax")&&(this.settings.$el.on("submit",this.sendForm.bind(this)),this.settings.$el.hasClass("ajax-submit-only")||this.settings.formElements.each(function(){n(this).on("change",t.sendForm.bind(t))}),this.settings.$el.find(".ajax-send")&&this.settings.$el.find(".ajax-send").each(function(){n(this).on("click",t.sendFormByLink.bind(t))}),this.settings.$el.find(".ajax-override-submit")&&this.settings.$el.find(".ajax-override-submit").each(function(){n(this).on("click",t.sendNormalFormByLink.bind(t))}),this.settings.$el.find(".ajax-override")&&this.settings.$el.find(".ajax-override").each(function(){"A"===n(this).prop("tagName")?n(this).on("click",t.overrideForm.bind(t)):"SELECT"===n(this).prop("tagName")&&n(this).on("change",t.overrideForm.bind(t))})):"A"===this.settings.elementType?this.settings.$el.on("click",this.sendLink.bind(this)):"TEMPLATE"===this.settings.elementType&&this.settings.$el.data("ajax-max-width")&&(e=this.debounce(this.sendOnViewport.bind(this),300),jQuery(i.visualViewport).on("resize",t=>{var s=i.visualViewport.width;n("body").hasClass("lock-scroll")||s!==this.settings.lastVisualViewportWidth&&(this.settings.lastVisualViewportWidth=s,e())}))},addLoadingIndicator:function(t){var s=n.parseHTML('<div class="'+this.settings.loadingIndicatorHtmlClass+'">'+this.settings.loadingIndicatorHtml+"</div>");this.settings.$el.addClass(this.settings.loadingIndicatorActiveClass).blur(),this.settings.indicatorTarget&&(this.settings.indicatorTarget.addClass(this.settings.loadingIndicatorTargetClass),this.settings.indicatorTarget.append(s))},removeLoadingIndicator:function(){try{this.settings.$el.removeClass(this.settings.loadingIndicatorActiveClass).blur()}catch(t){}this.settings.indicatorTarget&&(this.settings.indicatorTarget.removeClass(this.settings.loadingIndicatorTargetClass),this.settings.indicatorTarget.find("."+this.settings.loadingIndicatorHtmlClass).remove())},sendForm:function(t){var s,e,i;t.preventDefault(),this.settings.$el.hasClass("override-submit")||(s=this.settings.url,e=this.getFormValues(),i=this.generateRequestId(),this.ajaxRequest(i,s,e),this.addLoadingIndicator(t),this.settings.$el.hasClass("ajax-scroll-top")&&n("html, body").stop().animate({scrollTop:this.settings.$el.offset().top},1e3,"easeOutQuart"))},sendFormByLink:function(t){t.preventDefault(),this.sendForm(t)},sendNormalFormByLink:function(t){t.preventDefault();var s=n(t.currentTarget),t=s.closest("form.ajax");t.attr("action",s.attr("href")).addClass("override-submit"),t.unbind("submit"),t.submit()},sendLink:function(t){t.preventDefault();var s=this.settings.url,e=this.generateRequestId();this.settings.$el.hasClass(this.settings.loadingIndicatorActiveClass)||(this.ajaxRequest(e,s,[]),this.addLoadingIndicator(t))},sendField:function(t){var s=n(t.currentTarget),e=this.settings.feedbackUrl,t=s.serializeArray(),s=this.generateRequestId();this.ajaxRequest(s,e,t)},overrideForm:function(t){t.preventDefault();var s,e=n(t.currentTarget),i=this.settings.$el.find("select, input").not(".ajax-override").serializeArray(),t=this.generateRequestId();"A"===e.prop("tagName")?s=e.attr("href"):"SELECT"===e.prop("tagName")&&(s=e.val()),s&&this.ajaxRequest(t,s,i)},sendOnPageLoad:function(){var t=this.settings.url,s=this.generateRequestId();t&&this.ajaxRequest(s,t,[],!0)},sendOnViewport:function(){var t=this.settings.url,s=this.settings.$el,e=this.generateRequestId();t&&s.data("ajax-max-width")>=jQuery(i).width()&&this.ajaxRequest(e,t,[],!0)},getFormValues:function(){return this.settings.$el.serializeArray()},generateRequestId:function(){return Math.random().toString(36).substring(5)},ajaxRequest:function(t,s,e,i){var a=this;e.unshift({name:"type",value:250}),n.ajax({method:"post",url:s,data:n.param(e),dataType:"json",complete:function(t){try{t=JSON.parse(t.responseText),a.parseContent(t),a.removeLoadingIndicator(),i||a.updateBrowserHistory(t,s,n.param(e))}catch(t){console.log(t.message)}}})},parseContent:function(t){for(var s in t)if("message"===s){var e=t[s];for(a in e){var i=this.getMessageBox(e[a].message,e[a].type,a);this.appendContent(a,i)}}else if("data"!==s&&"html"===s){var a,n=t[s];for(a in n)for(var r in n[a])"append"===r?this.appendContent(a,n[a][r]):"prepend"===r?this.prependContent(a,n[a][r]):"replace"===r&&this.replaceContent(a,n[a][r])}},appendContent:function(t,s){try{var e=jQuery("#"+t);e.find("a").last().focus();var i=jQuery(s);i.ajaxApi().find(".ajax").ajaxApi(),i.appendTo(e),jQuery(a).trigger("tx-ajax-api-content-changed",i.parent())}catch(t){console.log(t.message)}},prependContent:function(t,s){try{var e=jQuery(s);e.ajaxApi().find(".ajax").ajaxApi(),e.prependTo(jQuery("#"+t)),jQuery(a).trigger("tx-ajax-api-content-changed",e.parent())}catch(t){console.log(t.message)}},replaceContent:function(t,s){try{var e;0<jQuery(s).length?((e=jQuery(s)).ajaxApi().find(".ajax").ajaxApi(),e.appendTo(jQuery("#"+t).empty()),jQuery(a).trigger("tx-ajax-api-content-changed",e)):jQuery("#"+t).empty().append(s)}catch(t){console.log(t.message)}},getMessageBox:function(t,s,e){t=jQuery('<div class="message-box" data-for="#'+e+'">'+t+"</div>");return 1===s?t.addClass(this.settings.boxSuccessClass):2===s?t.addClass(this.settings.boxHintClass):99===s&&t.addClass(this.settings.boxErrorClass),t},updateBrowserHistory:function(t,s,e){},debounce:function(s,e){var i;return function(){var t=this;clearTimeout(i),i=setTimeout(function(){s.apply(t)},e)}}}),n.fn[e]=function(t){return this.each(function(){n.data(this,"plugin_"+e)||n.data(this,"plugin_"+e,new s(this,t))})}}(jQuery,window,document);
